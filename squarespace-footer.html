<script>
const SQ = 'https://images.squarespace-cdn.com/content/v1/66212fe926016d54a680d742';
const projects = [
  {
    title: "Sound & Vision",
    overlayTitle: "Sound<br>& Vision",
    category: "Cover Art / Motion / Music",
    tools: "Illustrator, Photoshop, After Effects, Blender, AI",
    year: "2023–Present",
    cover: `${SQ}/deaea49e-6448-464f-99e9-a2f145935f1a/DnDFinal.jpeg`,
    images: [
      `${SQ}/aa281638-7fdc-433b-b723-9b9306b12ea0/Screenshot+2025-03-21+at+6.45.47+PM.png`,
      `${SQ}/11889cc5-3e77-4e5e-9eea-0d1d619d9608/DnDv3.png`,
      `${SQ}/55ca2c62-cfdb-40b2-a537-73f5b948ca8c/LoyaLOGOprocess.png`
    ],
    content: `<p>Collaborating with my brother, a musical artist who produces under our last name, Loya (stylized as "loya"), has been an ongoing creative journey where we bring his music to life visually through cover art, motion graphics, and social media content. From brainstorming concepts to refining final designs, every project is a balance of artistic vision and technical execution. Beyond our work, I've also created one-off pieces for other artists, tailoring visuals to fit their unique sounds and aesthetics.</p>
<p>Each project presents a new challenge—whether it's crafting a cover that captures an album's mood, designing looping animations for engagement, or developing a cohesive visual identity. Working closely with artists has deepened my understanding of how design shapes audience perception.</p>
<h3>loya</h3>
<p>The cover art is for loya's upcoming EP, <a href="https://open.spotify.com/album/6roxGKDYkVpcbcdqdpj6gG?si=mku1Dh4nR9OR_AJf92bb5Q" target="_blank" style="color:var(--accent);text-decoration:underline;"><em>Diamonds and Damage</em></a>, which he produced alongside his friend, Nicky. We started with a reference image to generate the portrait, then created multiple diamond variations. The assets were created by Adobe Firefly and then arranged, composed, and edited by me. After eight exports, we arrived at the final design.</p>
<p>I've also produced short vertical videos for loya's Spotify, known as "Canvas" visuals — dynamic, looping videos using After Effects and Blender. As loya's brand continued to grow, I designed a distinct logo based on one of his favorite hats, using Amador, a blackletter font that balances elegance with edge.</p>
<h3>Small Projects</h3>
<p>I pitched a cover art concept for the artist Sweezy. While ultimately rejected, I'm proud of the design. I also created a motion graphic and posters for Felly, an independent artist from my hometown with 556k monthly Spotify listeners. Additionally, I designed cover art for Chitt, who my brother and I met as a kid at our summer house.</p>`
  },
  {
    title: "BODYARMOR & Powerade",
    category: "Internship / Branding / AI",
    tools: "Photoshop, Illustrator, Premiere, After Effects, AI Tools",
    year: "2025",
    cover: `${SQ}/f2703cc4-c4fc-4ee4-aff6-d14b35406b51/bapa.png`,
    images: [
      `${SQ}/73084a73-f212-44aa-a487-b693b8f5b2e8/textclarity.jpg`,
      `${SQ}/c2f55235-1db6-4690-9bce-9b830c8779f1/textclarity.jpg`
    ],
    content: `<p>This past summer I had the opportunity to intern with BODYARMOR and Powerade in Queens, NY. Over the course of the internship, I learned from an incredibly talented group of people while building both personal and professional connections. My work ranged from designing POS advertisements to creating an original ad concept for Powerade's fall football campaign.</p>
<p>The highlight was my intern capstone project, where I explored the present and future role of AI in creative production. I produced a BODYARMOR commercial that was almost entirely AI-generated.</p>
<h3>Internship Work</h3>
<p>Much of my day-to-day focused on reformatting and resizing existing BODYARMOR and Powerade creative into POS ads — window clings, cooler clings, end caps, and other in-store displays. Beyond these adaptations, I produced a video ad for Powerade's fall football campaign, combining existing brand photography with stock video.</p>
<h3>Capstone Project</h3>
<p>My manager wanted me to explore how AI could be used in creative design. I initially wanted to create an AI commercial featuring Joe Burrow, but AI tools struggled with character consistency. I pivoted to focus strictly on product visuals.</p>
<p>I built a full AI production workflow — Runway and Kling for imagery/video, Topaz Labs for upscaling, ElevenLabs for voiceover, and After Effects for the final edit. A big part was prompt engineering — refining inputs and testing variations for consistent outputs.</p>
<h3>Final Result</h3>
<p>The end result was an entirely AI-generated BODYARMOR commercial. I presented to C-suite executives with insights on AI's role in creative production. My biggest takeaway: AI is powerful for quick-turn, low-budget content like product shots or social ads, but it isn't yet ready for high-end, campaign-level execution.</p>`
  },
  {
    title: "AI Song",
    category: "Music Production / AI / Design",
    tools: "FL Studio, ElevenLabs, Illustrator, ChatGPT",
    year: "2025",
    cover: `${SQ}/9eb3c8f9-733a-4b4b-84ba-d1de880e281c/LimitsCover.jpg`,
    images: [
      `${SQ}/55a88121-6df7-4566-8c31-520302171963/ChatGPT+Image+Sep+13%2C+2025%2C+04_19_47+PM.png`,
      `${SQ}/c9f24b87-d537-4e4f-a63d-ceb32513fe43/Screenshot+2025-04-22+at+12.15.48+AM.png`,
      `${SQ}/28ae2b92-5ee6-4ac0-bb38-6eb5751bcacf/IMG_8448.jpg`
    ],
    content: `<p>This personal project started with me listening to a lot of Jack Harlow and thinking, I could probably make a track in his style. I found a Jack Harlow–type beat on YouTube and started writing, and after finishing my first verse, I had the idea to bring in a fake feature—an AI version of Jack.</p>
<p>I trained a voice model using clips from existing Jack Harlow tracks, then generated a feature using ElevenLabs. I also designed the single's cover art, using AI as a tool to help visualize and refine the concept. AI wasn't just a gimmick; it became part of the process across multiple steps. When I posted the final track on social media, it fooled a few of my friends.</p>
<p>I used ChatGPT to generate a base concept for the cover, then cleaned it up and refined the design in Illustrator. To make the release more fun, I posted the song alongside a fake DM from Jack Harlow, mocked up in Photoshop. The response was huge — tons of friends and followers reached out asking if the DM was legit.</p>
<p>To create the AI voice, I uploaded nearly ten minutes of Jack's acapella vocals to train the model. Once trained, I ran my dry vocal recording through ElevenLabs. The result sounded surprisingly close to the real thing.</p>`
  },
  {
    title: "Mobile UIs",
    overlayTitle: "Mobile&nbsp;UIs",
    category: "UI/UX Design",
    tools: "Figma",
    year: "2025",
    cover: `${SQ}/29fc5895-8031-47df-93e5-10ecfc8a3c8e/iPhone+14+Mockup+%282%29.png`,
    images: [
      `${SQ}/a8202131-4ce6-444e-b521-0eb8c4be927c/Screenshot+2025-09-14+at+11.50.38+PM.png`,
      `${SQ}/0e65ef7d-2eea-46de-900d-28e3eeb85c21/Goal+Page.png`,
      `${SQ}/a502240e-23c4-4b5e-8f44-0999acf01879/Home+Page.png`
    ],
    content: `<p>This page showcases two mobile UI projects that allowed me to strengthen my UX design process while experimenting with different industries.</p>
<h3>MyPinecone</h3>
<p>For MyPinecone, a CRM application focused on simplifying contact management, I began by analyzing the existing web version. I studied competitor apps and observed real users. Several issues became clear: the sign-up process was unnecessarily difficult, there was significant clutter, and the overall direction was unclear.</p>
<p>I redesigned the sign-up flow to be cleaner and more approachable, overhauled the menus and main screens, and built an interactive prototype in Figma that showcased the updated flows in action.</p>
<h3>Medobar</h3>
<p>For Medobar, a Syracuse-based beekeeping company, I created a mobile UI exploration targeting adults 40+ curious about beekeeping. The design used a hexagon-based layout inspired by honeycomb cells, with each cell customizable to fit individual needs. I also designed a logo using shapes derived from the Medobar wordmark.</p>`
  },
  {
    title: "AR Drink Ad",
    overlayTitle: "AR&nbsp;Drink&nbsp;Ad",
    category: "AR / 3D / Branding",
    tools: "Snapchat Lens Studio, Blender, Illustrator",
    year: "2025",
    cover: `${SQ}/bbc69514-0894-407f-a62b-dda56b6f7112/FinalRenderv3.jpg`,
    images: [
      `${SQ}/bfac3c5c-1c39-4061-b978-a1d05fc31087/userpersona.jpg`,
      `${SQ}/748733ce-d856-416e-983c-d94ae92da428/Labels.png`,
      `${SQ}/93d5569c-1d61-41da-90a2-b212d05b58bc/FinalRenderv3.jpg`
    ],
    content: `<p>This project was part of a school assignment focused on creating an AR drink advertisement using Snapchat Lens Studio. It was my first experience modeling in Blender, where I learned to manipulate basic shapes into more complex forms.</p>
<p>The product I created was Chupaquila, a fictional tequila brand inspired by bold Mexican imagery and desert landscapes. I designed the drink label in Illustrator, modeled the bottle in Blender, and brought all the assets into Lens Studio. The name combines "Chupacabra" and "tequila." I used ChatGPT to verify real tequila bottle requirements like CRT numbers.</p>
<p>I designed the experience with a user persona in mind — Jordan Castillo, a 24-year-old marketer from NYC who values authenticity and fresh, aesthetic-driven content.</p>
<p>In Blender, I built the bottle from a basic cylinder, explored glass and cork materials, and modeled a shot glass. In Lens Studio, I explored head binding, background replacement, and eye color manipulation. The final result is playful, weird, and engaging — exactly what I wanted Chupaquila to be.</p>`
  },
  {
    title: "AR Business Card",
    overlayTitle: "AR Business<br>Card",
    category: "AR / Motion Capture / Music",
    tools: "8th Wall, Ready Player Me, DeepMotion AI, FL Studio",
    year: "2025",
    cover: `${SQ}/73f09a89-8665-4902-b9ad-52de7f510e65/Screenshot+2025-03-29+at+5.36.52+PM.jpg`,
    images: [
      `${SQ}/d12e4af4-81e8-40b4-9694-c69ea2976acd/IMG_7213.jpg`,
      `${SQ}/4c449415-2945-4603-81cf-d0a61f08dfb3/Screenshot+2025-03-28+231824.jpg`,
      `${SQ}/a93ca3fc-eca5-41b6-b5b4-94ab757cb1d1/Screenshot+2025-03-28+231959.png`
    ],
    content: `<p>For my augmented reality business card, I set out to create an interactive experience that went beyond a standard introduction. Using 8th Wall Niantic Studio, I integrated motion, 3D elements, and user interaction.</p>
<p>I brainstormed sports vs music concepts, settled on music for a more personal feel. I created a personalized avatar with Ready Player Me, wrote an 8-bar rap about my design skills, and recorded motion capture with DeepMotion AI.</p>
<p>For the rap production, I was inspired by a beat my brother had sent me. I built a vocal chain using stock FL Studio plugins — EQ, compression, delay, reverb, and widening. Then layered in doubled vocals, ad-libs, and sound effects.</p>
<p>In 8th Wall, I modeled the business card in Blender and imported it. One major challenge was timing — the user has to accept pop-ups before the experience loads, so I added animation delays. Another obstacle was preventing multiple avatar spawns on tap. The end result blends technology, music, and design into an engaging personal introduction.</p>`
  },
  {
    title: "Album Covers",
    category: "Graphic Design / Photography",
    tools: "Photoshop, Illustrator, Photography",
    year: "2024",
    cover: `whitenoise.jpg`,
    images: [
      `${SQ}/622797f0-f0bd-41b3-ba4b-874b4a18b7e3/Loya-Passion-Update-05.png`,
      `${SQ}/8585bec0-17e1-4f34-815f-93c2d643cd38/Loya-Passion-4.png`,
      `${SQ}/62b3ad12-2c72-4e9a-82d1-4a2e906f2593/Loya-Passion-6.png`,
      `${SQ}/892be344-edf9-4881-8e97-02fc89e0517c/scribbleboy.png`
    ],
    content: `<p>A collection of album covers I created that combines graphic design and photography, named "Visual Harmonies: A Fusion of Lens and Design." From selecting evocative environments to directing photo shoots and refining designs, this project showcases my multifaceted skill set.</p>
<p>Inspired by the need for striking visuals for my music, each cover reflects meticulous attention to detail and a dedication to professionalism. Through this project, I expanded my creative toolkit, honed my photography skills, and gained proficiency in Photoshop and Illustrator.</p>`
  },
  {
    title: "Photography Portfolio",
    category: "Photography",
    tools: "Camera, Lightroom",
    year: "2023",
    cover: `${SQ}/d8f89002-cb97-456c-ae1f-2cdb2ae86b7c/20231003_VIS201_Loya_Portfolio_01.jpg`,
    images: [
      `${SQ}/d76f50b2-3047-4346-93eb-77d465a73847/20231115_VIS201_Loya_Portfolio_03.jpg`,
      `${SQ}/294f2c1d-6488-4602-b5d7-a2b477b08e12/20231012_VIS201_Loya_Portfolio_09.jpg`,
      `${SQ}/e0b25fa4-eba4-4a5f-a794-dfd83697e723/20231002_VIS201_Loya_Portfolio_07.jpg`,
      `${SQ}/bd460f69-a37f-404a-86f0-d9751596e1ed/20231026_VIS201_Loya_Portfolio_02.jpg`,
      `${SQ}/11aa00ed-1f7e-485b-b263-2d9a33a75a3d/20231012_VIS201_Loya_Portfolio_05.jpg`
    ],
    content: `<p>These ten black-and-white photographs showcase the essence of my early journey into photography, a time defined by experimentation and discovery. Each shot captures moments of raw emotion, intricate textures, and striking contrasts, reflecting my fascination with the interplay of light and shadow.</p>
<p>Through these images, I explore themes of simplicity and depth, aiming to tell stories that resonate beyond color. This collection is a testament to my passion for capturing the beauty in everyday life and my commitment to honing my skills as a visual storyteller.</p>`
  },
  {
    title: "Miscellaneous Projects",
    category: "Mixed / Passion Projects",
    tools: "Various",
    year: "2022–Present",
    cover: `${SQ}/14a0b177-739f-4563-9695-8065e35e2d02/2023+Freshmen.png`,
    images: [
      `${SQ}/ed634efc-adf9-463c-bc8e-2f5573912c81/TalentShow.png`,
      `${SQ}/14a0b177-739f-4563-9695-8065e35e2d02/2023+Freshmen.png`,
      `${SQ}/955f8a36-6b63-4bd7-ad47-358d8235a877/PA+Show+v4.png`,
      `${SQ}/6b8b2050-86e0-42f1-bfce-9bde512c152a/2024VolleyballFinalFour.jpg`
    ],
    content: `<p>This collection represents the depth and diversity of my creative journey, encompassing personal passion projects, academic assignments, professional work, and collaborations with family and friends. Each piece tells a story of exploration, problem-solving, and growth.</p>
<p>While not every concept made it to final production, even the designs that were set aside serve as a testament to my creative process. Some of these rejected ideas still hold merit, demonstrating that innovation often comes from iteration and experimentation. Every project has shaped my ability to push boundaries and refine ideas into compelling, effective solutions.</p>`
  }
];

const galleryTrack = document.getElementById('galleryTrack');
const overlay = document.getElementById('overlay');
const closeBtn = document.getElementById('closeBtn');
const projectContent = document.getElementById('projectContent');

const N = projects.length;
let currentCenter = 0;
let isAnimating = false;
const VISIBLE_HALF = 4;
const ANIM_MS = 400;

function getCoverSize() {
  const vw = window.innerWidth;
  if (vw <= 480) return 140;
  if (vw <= 768) return 180;
  if (vw <= 900) return 210;
  if (vw <= 1200) return 250;
  return 300;
}

const items = [];

projects.forEach((project, i) => {
  const item = document.createElement('div');
  item.className = 'gallery-item';
  item.innerHTML = `
    <div class="cover-wrap">
      <img src="${project.cover}" alt="${project.title}" loading="lazy" draggable="false">
    </div>
    <div class="gallery-vinyl"></div>
    <div class="gallery-info">
      <h3>${project.title}</h3>
      <div class="category">${project.category}</div>
    </div>
  `;
  item.addEventListener('click', () => {
    if (i === currentCenter) openProject(i);
  });
  galleryTrack.appendChild(item);
  items.push(item);
});

function wrapOffset(i, center, n) {
  let d = i - center;
  if (d > n / 2) d -= n;
  if (d < -n / 2) d += n;
  return d;
}

// Calculate target state for an item
function calcState(i, center) {
  const coverSz = getCoverSize();
  const baseSpacing = Math.round(coverSz * 0.55);
  const offset = wrapOffset(i, center, N);
  const absOff = Math.abs(offset);
  const scale = absOff === 0 ? 1.15 : Math.max(0.65, 1 - absOff * 0.08);
  // Smooth opacity: fully visible within range, fade at the edge
  let opacity;
  if (absOff > VISIBLE_HALF + 1) opacity = 0;
  else if (absOff > VISIBLE_HALF) opacity = 0;
  else if (absOff === VISIBLE_HALF) opacity = 0.4;
  else opacity = 1;
  // Accumulate spacing — extra gap at ±1 to clear center cover + vinyl
  let x = 0;
  for (let j = 1; j <= absOff; j++) {
    const stepSpacing = j === 1 ? baseSpacing * 1.4 : baseSpacing * (1 - (j - 2) * 0.12);
    x += stepSpacing;
  }
  x *= Math.sign(offset);
  return {
    x,
    scale,
    rotateY: offset === 0 ? 0 : (offset < 0 ? 35 : -35),
    brightness: absOff === 0 ? 1 : Math.max(0.3, 0.85 - absOff * 0.15),
    opacity,
    zIndex: absOff === 0 ? 50 : (N + 1 - absOff),
    isCenter: offset === 0,
    absOff,
    shadowIntensity: absOff === 0 ? 1 : 0
  };
}

// Apply state to an item (no animation)
function applyState(item, s) {
  const coverSz = getCoverSize();
  const itemCover = Math.round(coverSz * s.scale);

  const coverEl = item.querySelector('.cover-wrap');
  coverEl.style.width = itemCover + 'px';
  coverEl.style.height = itemCover + 'px';

  item.style.transform = `translate(-50%, -50%) translateX(${s.x}px) perspective(1200px) rotateY(${s.rotateY}deg) scale(${s.scale})`;
  item.style.zIndex = s.zIndex;
  item.style.opacity = s.opacity;
  item.style.filter = `brightness(${s.brightness})`;
  item.classList.toggle('is-center', s.isCenter);

  // Animated shadow: blend between base shadow and center shadow
  const si = s.shadowIntensity || 0;
  const baseBlur = 30, centerBlur = 55, centerSpread = 40;
  const blur = baseBlur + (centerBlur - baseBlur) * si;
  const yOff = 8 + 6 * si;
  const alpha = 0.5 + 0.15 * si;
  const glowAlpha = 0.06 * si;
  coverEl.style.boxShadow = `0 ${yOff}px ${blur}px rgba(0,0,0,${alpha.toFixed(3)})` +
    (si > 0.01 ? `, 0 0 ${centerSpread * si}px rgba(232,220,200,${glowAlpha.toFixed(3)})` : '');
}

// Animate vinyl sliding out from behind center cover
let vinylAnim = null;
function animateVinyl() {
  // Reset all vinyls
  items.forEach(item => {
    const v = item.querySelector('.gallery-vinyl');
    v.style.transform = 'translateX(0px)';
    v.style.opacity = '0';
  });
  // Slide out the center vinyl
  const centerVinyl = items[currentCenter].querySelector('.gallery-vinyl');
  if (vinylAnim) cancelAnimationFrame(vinylAnim);
  const dur = 600;
  const t0 = performance.now();
  centerVinyl.style.opacity = '1';
  function tickVinyl(now) {
    const p = Math.min((now - t0) / dur, 1);
    // overshoot ease
    const ease = p < 1 ? 1 - Math.pow(1 - p, 3) : 1;
    centerVinyl.style.transform = `translateX(${ease * 55}px)`;
    if (p < 1) vinylAnim = requestAnimationFrame(tickVinyl);
    else vinylAnim = null;
  }
  vinylAnim = requestAnimationFrame(tickVinyl);
}

function layoutInstant() {
  items.forEach((item, i) => applyState(item, calcState(i, currentCenter)));
  // Move center item to end of DOM so it paints on top
  const centerItem = items[currentCenter];
  if (centerItem && centerItem.parentNode) {
    centerItem.parentNode.appendChild(centerItem);
  }
  // Slide vinyl out on center
  animateVinyl();
}

// Animate from current positions to new center
function animateTo(newCenter, duration) {
  const oldCenter = currentCenter;
  currentCenter = newCenter;

  // Animate old center's vinyl sliding back in
  if (vinylAnim) { cancelAnimationFrame(vinylAnim); vinylAnim = null; }
  const oldVinyl = items[oldCenter].querySelector('.gallery-vinyl');
  const retractDur = 300;
  const retractStart = performance.now();
  const startX = parseFloat(oldVinyl.style.transform.replace(/[^0-9.-]/g,'')) || 55;
  function retractTick(now) {
    const p = Math.min((now - retractStart) / retractDur, 1);
    const ease = p * p; // ease-in
    const x = startX * (1 - ease);
    oldVinyl.style.transform = `translateX(${x}px)`;
    if (p >= 1) oldVinyl.style.opacity = '0';
    if (p < 1) requestAnimationFrame(retractTick);
  }
  requestAnimationFrame(retractTick);

  // Get current states and target states
  const startStates = items.map((_, i) => calcState(i, oldCenter));
  const endStates = items.map((_, i) => calcState(i, newCenter));

  // Items that wrap around the ring: fade out at old pos, fade in at new pos
  const wrappingItems = new Set();
  items.forEach((item, i) => {
    const oldOff = Math.abs(wrapOffset(i, oldCenter, N));
    const newOff = Math.abs(wrapOffset(i, newCenter, N));
    const oldSign = Math.sign(wrapOffset(i, oldCenter, N));
    const newSign = Math.sign(wrapOffset(i, newCenter, N));
    const isWrapping = oldSign !== 0 && newSign !== 0 && oldSign !== newSign;
    // If fully hidden on both ends, just snap
    if (oldOff > VISIBLE_HALF && newOff > VISIBLE_HALF) {
      applyState(item, endStates[i]);
      startStates[i] = endStates[i];
    }
    // If wrapping around the ring: fade out first half, reposition, fade in second half
    else if (isWrapping) {
      wrappingItems.add(i);
      // Start from current visible state but will fade out
      startStates[i] = { ...startStates[i], opacity: startStates[i].opacity };
    }
  });

  const startTime = performance.now();

  function tick(now) {
    const t = Math.min((now - startTime) / duration, 1);
    const ease = t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t; // easeInOutQuad

    items.forEach((item, i) => {
      const s = startStates[i];
      const e = endStates[i];
      if (wrappingItems.has(i)) {
        // Slide off the old edge, then slide in from the new edge
        const slideExtra = getCoverSize() * 0.6; // how far past edge to slide
        if (t < 0.5) {
          const p = t / 0.5; // 0 → 1
          const slideEase = p * p;
          // Slide further out in the direction it was already at
          const exitX = s.x + Math.sign(s.x) * slideExtra * slideEase;
          const fadeOut = 1 - slideEase;
          applyState(item, {
            x: exitX,
            scale: s.scale,
            rotateY: s.rotateY,
            brightness: s.brightness,
            opacity: s.opacity * fadeOut,
            zIndex: e.zIndex,
            isCenter: false,
            absOff: s.absOff,
            shadowIntensity: (s.shadowIntensity || 0) * fadeOut
          });
        } else {
          const p = (t - 0.5) / 0.5; // 0 → 1
          const slideEase = 1 - (1 - p) * (1 - p); // ease-out
          // Start from further out on new side, slide to final position
          const entryX = e.x + Math.sign(e.x) * slideExtra * (1 - slideEase);
          applyState(item, {
            x: entryX,
            scale: e.scale,
            rotateY: e.rotateY,
            brightness: e.brightness,
            opacity: e.opacity * slideEase,
            zIndex: e.zIndex,
            isCenter: e.isCenter,
            absOff: e.absOff,
            shadowIntensity: (e.shadowIntensity || 0) * slideEase
          });
        }
      } else {
        applyState(item, {
          x: s.x + (e.x - s.x) * ease,
          scale: s.scale + (e.scale - s.scale) * ease,
          rotateY: s.rotateY + (e.rotateY - s.rotateY) * ease,
          brightness: s.brightness + (e.brightness - s.brightness) * ease,
          opacity: s.opacity + (e.opacity - s.opacity) * ease,
          zIndex: e.zIndex,
          isCenter: e.isCenter,
          absOff: e.absOff,
          shadowIntensity: (s.shadowIntensity || 0) + ((e.shadowIntensity || 0) - (s.shadowIntensity || 0)) * ease
        });
      }
    });

    if (t < 1) {
      requestAnimationFrame(tick);
    } else {
      isAnimating = false;
      // Move center item to end of DOM so it paints on top
      const centerItem = items[currentCenter];
      if (centerItem && centerItem.parentNode) {
        centerItem.parentNode.appendChild(centerItem);
      }
      // Slide vinyl out on new center
      animateVinyl();
    }
  }

  requestAnimationFrame(tick);
}

function navigate(dir) {
  if (isAnimating) return;
  isAnimating = true;
  const newCenter = ((currentCenter + dir) % N + N) % N;
  animateTo(newCenter, ANIM_MS);
}

document.getElementById('arrowLeft').addEventListener('click', () => navigate(-1));
document.getElementById('arrowRight').addEventListener('click', () => navigate(1));

document.addEventListener('keydown', (e) => {
  if (overlay.classList.contains('open')) return;
  if (e.key === 'ArrowLeft') navigate(-1);
  if (e.key === 'ArrowRight') navigate(1);
});

layoutInstant();
window.addEventListener('resize', layoutInstant);

function openProject(index) {
  const p = projects[index];
  const galleryHTML = p.images.map(src => `<img src="${src}" alt="${p.title}" loading="lazy">`).join('');

  projectContent.innerHTML = `
    <div class="now-playing active">
      <div class="bars">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </div>
      <div class="track-info">Now Playing — <strong>${p.title}</strong></div>
    </div>
    <div class="project-header">
      <div class="project-vinyl-wrap">
        <img class="project-cover" src="${p.cover}" alt="${p.title}">
      </div>
      <div class="turntable" id="turntable">
        <div class="turntable-platter">
          <div class="turntable-label">
            <img src="${p.cover}" alt="${p.title}">
          </div>
        </div>
        <div class="tonearm-wrap">
          <svg viewBox="0 0 200 200">
            <!-- Tonearm pivots at top-right, arm extends left -->
            <g class="arm-group" transform="rotate(15 170 30)">
              <!-- Pivot base -->
              <circle cx="170" cy="30" r="12" fill="#444" stroke="#666" stroke-width="1.5"/>
              <circle cx="170" cy="30" r="6" fill="#555" stroke="#777" stroke-width="1"/>
              <!-- Arm bar — extends left from pivot, horizontal at rest -->
              <line x1="170" y1="30" x2="30" y2="30" stroke="#aaa" stroke-width="3.5" stroke-linecap="round"/>
              <!-- Counterweight on right side of pivot -->
              <ellipse cx="185" cy="30" rx="8" ry="6" fill="#666" stroke="#555" stroke-width="1"/>
              <!-- Headshell — angled piece at end of arm -->
              <line x1="30" y1="30" x2="18" y2="42" stroke="#999" stroke-width="3" stroke-linecap="round"/>
              <!-- Cartridge -->
              <rect x="13" y="40" width="10" height="8" rx="1.5" fill="#777"/>
              <!-- Needle/stylus -->
              <line x1="18" y1="48" x2="18" y2="54" stroke="#ddd" stroke-width="1.5" stroke-linecap="round"/>
            </g>
          </svg>
        </div>
      </div>
      <div class="project-details">
        <div class="category">${p.category}</div>
        <h2>${p.overlayTitle || p.title}</h2>
        <div class="project-meta">
          <div>
            <span class="label">Year</span>
            <span class="value">${p.year}</span>
          </div>
          <div>
            <span class="label">Tools</span>
            <span class="value">${p.tools.split(', ').join('<br>')}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="project-body">
      ${p.content}
    </div>
    <div class="project-gallery">
      ${galleryHTML}
    </div>
  `;

  overlay.classList.add('open');
  overlay.scrollTop = 0;
  document.body.style.overflow = 'hidden';

  // Animate tonearm onto record after slide-in
  setTimeout(() => {
    const tt = document.getElementById('turntable');
    if (tt) {
      tt.classList.add('playing');
      // Animate SVG tonearm: off record (15°) → on record (0°)
      const arm = tt.querySelector('.arm-group');
      if (arm) {
        const start = 15, end = 0, dur = 1400;
        const t0 = performance.now();
        function animArm(now) {
          const p = Math.min((now - t0) / dur, 1);
          const ease = p < 0.5 ? 2*p*p : -1+(4-2*p)*p;
          const angle = start + (end - start) * ease;
          arm.setAttribute('transform', `rotate(${angle} 170 30)`);
          if (p < 1) requestAnimationFrame(animArm);
        }
        requestAnimationFrame(animArm);
      }
    }
  }, 900);
}

closeBtn.addEventListener('click', closeProject);
overlay.addEventListener('click', (e) => {
  if (e.target === overlay) closeProject();
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeProject();
});

function closeProject() {
  overlay.classList.remove('open');
  document.body.style.overflow = '';
}

// Page navigation
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.getElementById('nav-' + page).classList.add('active');
  window.scrollTo(0, 0);
}
</script>
